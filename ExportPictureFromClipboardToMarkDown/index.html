<!DOCTYPE html><html lang="zh-CN" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="generator" content="Jekyll v4.2.2" /><meta property="og:title" content="PowerShell保存剪贴板图片并构造MarkDown语句" /><meta property="og:locale" content="zh_CN" /><meta name="description" content="目标 最近在学着用MarkDown写文档，对传图片深恶痛绝。准备自己用PowerShell造个轮子，还好提前搜索，找到了很多大哥的文档。 整个要做的事情流程是 鼠标复制个剪贴板图片 进入程序处理逻辑 处理剪贴板图片，保存成本地文件（png或者jpg） 上传到一个图床，获取图床的连接 把图床的链接构造成MarkDown要求的格式，塞回剪贴板。 回到MarkDown编辑器，直接剪贴。" /><meta property="og:description" content="目标 最近在学着用MarkDown写文档，对传图片深恶痛绝。准备自己用PowerShell造个轮子，还好提前搜索，找到了很多大哥的文档。 整个要做的事情流程是 鼠标复制个剪贴板图片 进入程序处理逻辑 处理剪贴板图片，保存成本地文件（png或者jpg） 上传到一个图床，获取图床的连接 把图床的链接构造成MarkDown要求的格式，塞回剪贴板。 回到MarkDown编辑器，直接剪贴。" /><link rel="canonical" href="https://kukisama.github.io/ExportPictureFromClipboardToMarkDown/" /><meta property="og:url" content="https://kukisama.github.io/ExportPictureFromClipboardToMarkDown/" /><meta property="og:site_name" content="不太皮的九叔" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2019-11-07T00:00:00+08:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="PowerShell保存剪贴板图片并构造MarkDown语句" /><meta name="twitter:site" content="@jiuzige" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2022-08-18T15:21:21+08:00","datePublished":"2019-11-07T00:00:00+08:00","description":"目标 最近在学着用MarkDown写文档，对传图片深恶痛绝。准备自己用PowerShell造个轮子，还好提前搜索，找到了很多大哥的文档。 整个要做的事情流程是 鼠标复制个剪贴板图片 进入程序处理逻辑 处理剪贴板图片，保存成本地文件（png或者jpg） 上传到一个图床，获取图床的连接 把图床的链接构造成MarkDown要求的格式，塞回剪贴板。 回到MarkDown编辑器，直接剪贴。","headline":"PowerShell保存剪贴板图片并构造MarkDown语句","mainEntityOfPage":{"@type":"WebPage","@id":"https://kukisama.github.io/ExportPictureFromClipboardToMarkDown/"},"url":"https://kukisama.github.io/ExportPictureFromClipboardToMarkDown/"}</script><title>PowerShell保存剪贴板图片并构造MarkDown语句 | 不太皮的九叔</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="不太皮的九叔"><meta name="application-name" content="不太皮的九叔"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" crossorigin><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get MODE_ATTR() { return "data-mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } static get ID() { return "mode-toggle"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } let self = this; /* always follow the system prefers */ this.sysDarkPrefers.addEventListener("change", () => { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.notify(); }); } /* constructor() */ get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode === ModeToggle.DARK_MODE; } get isLightMode() { return this.mode === ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer)) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } setDark() { $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_ATTR); sessionStorage.removeItem(ModeToggle.MODE_KEY); } /* Notify another plugins that the theme mode has changed */ notify() { window.postMessage({ direction: ModeToggle.ID, message: this.modeStatus }, "*"); } } /* ModeToggle */ const toggle = new ModeToggle(); function flipMode() { if (toggle.hasMode) { if (toggle.isSysDarkPrefer) { if (toggle.isLightMode) { toggle.clearMode(); } else { toggle.setLight(); } } else { if (toggle.isDarkMode) { toggle.clearMode(); } else { toggle.setDark(); } } } else { if (toggle.isSysDarkPrefer) { toggle.setLight(); } else { toggle.setDark(); } } toggle.notify(); } /* flipMode() */ </script><body data-spy="scroll" data-target="#toc" data-topbar-visible="true"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" class="mx-auto"> <img src="/avatar.jpg" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">不太皮的九叔</a></div><div class="site-subtitle font-italic">一个不爱吹牛逼的打工仔</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>首页</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>分类</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i> <span>标签</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>归档</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>关于</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <button class="mode-toggle btn" aria-label="Switch Mode"> <i class="fas fa-adjust"></i> </button> <span class="icon-border"></span> <a href="https://github.com/kukisama" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github"></i> </a> <a href="https://twitter.com/jiuzige" aria-label="twitter" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['a9y#foxmail.com',''].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></div><div id="topbar-wrapper"><div id="topbar" class="container d-flex align-items-center justify-content-between h-100 pl-3 pr-3 pl-md-4 pr-md-4"> <span id="breadcrumb"> <span> <a href="/"> 首页 </a> </span> <span>PowerShell保存剪贴板图片并构造MarkDown语句</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> 文章</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="搜索..."> </span> <span id="search-cancel" >取消</span></div></div><div id="main-wrapper" class="d-flex justify-content-center"><div id="main" class="container pl-xl-4 pr-xl-4"><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-9 pr-xl-4"><div class="post pl-1 pr-1 pl-md-2 pr-md-2"><h1 data-toc-skip>PowerShell保存剪贴板图片并构造MarkDown语句</h1><div class="post-meta text-muted"> <span> 发表于 <em class="" data-ts="1573056000" data-df="YYYY-MM-DD" data-toggle="tooltip" data-placement="bottom"> 2019-11-07 </em> </span> <span> 更新于 <em class="" data-ts="1660807281" data-df="YYYY-MM-DD" data-toggle="tooltip" data-placement="bottom"> 2022-08-18 </em> </span><div class="d-flex justify-content-between"> <span> 作者 <em> <a href="https://twitter.com/jiuzige">不太皮的九叔</a> </em> </span><div> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="2863 字"> <em>15 分钟</em>阅读</span></div></div></div><div class="post-content"><h2 id="目标"><span class="mr-2">目标</span><a href="#目标" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>最近在学着用MarkDown写文档，对传图片深恶痛绝。准备自己用PowerShell造个轮子，还好提前搜索，找到了很多大哥的文档。</p><blockquote><p>整个要做的事情流程是</p><ol><li>鼠标复制个剪贴板图片<li>进入程序处理逻辑<ol><li>处理剪贴板图片，保存成本地文件（png或者jpg）<li>上传到一个图床，获取图床的连接<li>把图床的链接构造成MarkDown要求的格式，塞回剪贴板。</ol><li>回到MarkDown编辑器，直接剪贴。</ol></blockquote><blockquote><p>目标是2阶段的内容，完全用脚本实现。</p></blockquote><h1 id="实现">实现</h1><p>PowerShell对文件的操作进行创建修改是比较简单的，关键的地方在这里，用到了.net的方法直接去操作图片</p><div class="language-powershell highlighter-rouge"><div class="code-header"> <span data-label-text="Powershell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nv">$img</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="n">Windows.Clipboard</span><span class="p">]::</span><span class="n">GetImage</span><span class="p">()</span><span class="w">
</span></pre></table></code></div></div><p>根据这个关键字，我们看一下 <a href="https://docs.microsoft.com/en-us/dotnet/api/system.windows.clipboard?view=netframework-4.8">Clipboard Class</a>，里面有介绍到这个具体的方法</p><p>GetImage() | Returns a BitmapSource object from the Clipboard that contains data in the Bitmap format. —|— 这里不光可以get，还可以set，不光是图片，文字音频都可以操作，算是针对剪贴板的一整套方案都有了。原文输出的格式是PNG的，我想试试如何输出JPG</p><h2 id="图片"><span class="mr-2">图片</span><a href="#图片" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>刚才只是搞定了剪贴板的内容，接下来针对剪贴板数据，还需要保存成图片。</p><h2 id="代码"><span class="mr-2">代码</span><a href="#代码" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>这个可以学习下</p><p><a href="https://docs.microsoft.com/en-us/dotnet/api/system.drawing.imaging.imagecodecinfo.getimageencoders?view=netframework-4.8">ImageCodecInfo.GetImageEncoders Method </a></p><hr /><h3 id="剪贴板保存png"><span class="mr-2">剪贴板保存PNG</span><a href="#剪贴板保存png" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><div class="language-powershell highlighter-rouge"><div class="code-header"> <span data-label-text="Powershell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
</pre><td class="rouge-code"><pre><span class="c">#剪贴板直接保存png</span><span class="w">
</span><span class="n">Add-Type</span><span class="w"> </span><span class="nt">-Assembly</span><span class="w"> </span><span class="nx">PresentationCore</span><span class="w">
</span><span class="nv">$img</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="n">Windows.Clipboard</span><span class="p">]::</span><span class="n">GetImage</span><span class="p">()</span><span class="w">
</span><span class="kr">if</span><span class="w"> </span><span class="p">(</span><span class="bp">$null</span><span class="w"> </span><span class="o">-eq</span><span class="w"> </span><span class="nv">$img</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
  </span><span class="n">Write-Host</span><span class="w"> </span><span class="s2">"剪贴板无图"</span><span class="w">
  </span><span class="kr">Exit</span><span class="w">
</span><span class="p">}</span><span class="w">
</span><span class="nv">$fcb</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">New-Object</span><span class="w"> </span><span class="nx">Windows.Media.Imaging.FormatConvertedBitmap</span><span class="p">(</span><span class="nv">$img</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="n">Windows.Media.PixelFormats</span><span class="p">]::</span><span class="n">Rgb24</span><span class="p">,</span><span class="w"> </span><span class="bp">$null</span><span class="p">,</span><span class="w"> </span><span class="nx">0</span><span class="p">)</span><span class="w">
</span><span class="nv">$filename</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">((</span><span class="n">Get-Date</span><span class="w"> </span><span class="nt">-f</span><span class="w"> </span><span class="nx">s</span><span class="p">)</span><span class="w"> </span><span class="o">-replace</span><span class="w"> </span><span class="s1">'[-T:]'</span><span class="p">,</span><span class="w"> </span><span class="s1">''</span><span class="p">)</span><span class="w">
</span><span class="nv">$file</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"c:/img/{0}.jpg"</span><span class="w"> </span><span class="nt">-f</span><span class="w"> </span><span class="nv">$filename</span><span class="w">
</span><span class="n">Write-Host</span><span class="w"> </span><span class="p">(</span><span class="s2">"</span><span class="se">`n</span><span class="s2"> 找到图片. {0}x{1} 像素，保存到{2}</span><span class="se">`n</span><span class="s2">"</span><span class="w"> </span><span class="nt">-f</span><span class="w"> </span><span class="nv">$img</span><span class="o">.</span><span class="nf">PixelWidth</span><span class="p">,</span><span class="w"> </span><span class="nv">$img</span><span class="o">.</span><span class="nf">PixelHeight</span><span class="p">,</span><span class="w"> </span><span class="nv">$file</span><span class="p">)</span><span class="w">
</span><span class="nv">$stream</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="n">IO.File</span><span class="p">]::</span><span class="n">Open</span><span class="p">(</span><span class="nv">$file</span><span class="p">,</span><span class="w"> </span><span class="s2">"OpenOrCreate"</span><span class="p">)</span><span class="w">
</span><span class="nv">$encoder</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">New-Object</span><span class="w"> </span><span class="nx">Windows.Media.Imaging.PngBitmapEncoder</span><span class="w">
</span><span class="nv">$encoder</span><span class="o">.</span><span class="nf">Frames</span><span class="o">.</span><span class="nf">Add</span><span class="p">([</span><span class="n">Windows.Media.Imaging.BitmapFrame</span><span class="p">]::</span><span class="nx">Create</span><span class="p">(</span><span class="nv">$fcb</span><span class="p">))</span><span class="w">
</span><span class="nv">$encoder</span><span class="o">.</span><span class="nf">Save</span><span class="p">(</span><span class="nv">$stream</span><span class="p">)</span><span class="w">
</span><span class="c"># $stream.Dispose()</span><span class="w">
</span></pre></table></code></div></div><h3 id="各种花式不局限于powershell"><span class="mr-2">各种花式，不局限于PowerShell</span><a href="#各种花式不局限于powershell" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><div class="language-powershell highlighter-rouge"><div class="code-header"> <span data-label-text="Powershell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre><td class="rouge-code"><pre><span class="p">{</span><span class="w">
    </span><span class="n">Bitmap</span><span class="w"> </span><span class="nx">bmp1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="nx">Bitmap</span><span class="p">(</span><span class="n">typeof</span><span class="p">(</span><span class="n">Button</span><span class="p">),</span><span class="w"> </span><span class="s2">"Button.bmp"</span><span class="p">);</span><span class="w">
    </span><span class="n">bmp1.Save</span><span class="p">(</span><span class="sh">@"c:\button.png", ImageFormat.Png);
}
#相对简单存储图片
#https://stackoverflow.com/questions/41665/bmp-to-jpg-png-in-c-sharp
#高级存储图片
#https://stackoverflow.com/questions/1484759/quality-of-a-saved-jpg-in-c-sharp
#官方例子
#https://docs.microsoft.com/en-us/dotnet/api/system.drawing.imaging.imagecodecinfo.getimageencoders?view=netframework-4.8

</span></pre></table></code></div></div><h3 id="png转换jpg"><span class="mr-2">PNG转换JPG</span><a href="#png转换jpg" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>这里用到了一个技巧，就是 <code class="language-plaintext highlighter-rouge">Add-Type -AssemblyName system.drawing</code></p><div class="language-powershell highlighter-rouge"><div class="code-header"> <span data-label-text="Powershell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
</pre><td class="rouge-code"><pre><span class="w">    </span><span class="n">Add-Type</span><span class="w"> </span><span class="nt">-AssemblyName</span><span class="w"> </span><span class="nx">system.drawing</span><span class="w">
    </span><span class="nv">$Source</span><span class="o">=</span><span class="err">“</span><span class="n">C:\img\tt2.png</span><span class="err">”</span><span class="w">
    </span><span class="nv">$imageFormat</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"System.Drawing.Imaging.ImageFormat"</span><span class="w"> </span><span class="o">-as</span><span class="w"> </span><span class="p">[</span><span class="n">type</span><span class="p">]</span><span class="w">
    </span><span class="nv">$image</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="n">drawing.image</span><span class="p">]::</span><span class="n">FromFile</span><span class="p">(</span><span class="nv">$Source</span><span class="p">)</span><span class="w">
    </span><span class="c"># 创建新图像</span><span class="w">
    </span><span class="nv">$NewImage</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="n">System.Drawing.Bitmap</span><span class="p">]::</span><span class="n">new</span><span class="p">(</span><span class="nv">$Image</span><span class="o">.</span><span class="nf">Width</span><span class="p">,</span><span class="nv">$Image</span><span class="o">.</span><span class="nf">Height</span><span class="p">)</span><span class="w">
    </span><span class="nv">$NewImage</span><span class="o">.</span><span class="nf">SetResolution</span><span class="p">(</span><span class="nv">$Image</span><span class="o">.</span><span class="nf">HorizontalResolution</span><span class="p">,</span><span class="nv">$Image</span><span class="o">.</span><span class="nf">VerticalResolution</span><span class="p">)</span><span class="w">
    </span><span class="c">#根据新图像添加图形</span><span class="w">
    </span><span class="nv">$Graphics</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="n">System.Drawing.Graphics</span><span class="p">]::</span><span class="n">FromImage</span><span class="p">(</span><span class="nv">$NewImage</span><span class="p">)</span><span class="w">
    </span><span class="nv">$Graphics</span><span class="o">.</span><span class="nf">Clear</span><span class="p">([</span><span class="n">System.Drawing.Color</span><span class="p">]::</span><span class="nx">White</span><span class="p">)</span><span class="w"> </span><span class="c"># Set the color to white</span><span class="w">
    </span><span class="nv">$Graphics</span><span class="o">.</span><span class="nf">DrawImageUnscaled</span><span class="p">(</span><span class="nv">$image</span><span class="p">,</span><span class="nx">0</span><span class="p">,</span><span class="nx">0</span><span class="p">)</span><span class="w"> </span><span class="c"># Add the contents of $image</span><span class="w">
    </span><span class="c">#存储</span><span class="w">
    </span><span class="nv">$NewImage</span><span class="o">.</span><span class="nf">Save</span><span class="p">(</span><span class="s2">"c:\img\vvv.jpg"</span><span class="p">,</span><span class="nv">$imageFormat</span><span class="p">::</span><span class="nx">Jpeg</span><span class="p">)</span><span class="w">

</span></pre></table></code></div></div><h3 id="读取一个img调整大小以及写入"><span class="mr-2">读取一个IMG，调整大小，以及写入</span><a href="#读取一个img调整大小以及写入" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><div class="language-powershell highlighter-rouge"><div class="code-header"> <span data-label-text="Powershell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre><td class="rouge-code"><pre><span class="w">
</span><span class="n">Add-Type</span><span class="w"> </span><span class="nt">-AssemblyName</span><span class="w"> </span><span class="nx">System.Drawing</span><span class="w"> 
</span><span class="nv">$img</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">New-Object</span><span class="w"> </span><span class="nx">System.Drawing.Bitmap</span><span class="p">(</span><span class="mi">96</span><span class="p">,</span><span class="w"> </span><span class="mi">96</span><span class="p">)</span><span class="w"> 
</span><span class="p">([</span><span class="n">System.Drawing.Graphics</span><span class="p">]::</span><span class="n">FromImage</span><span class="p">(</span><span class="nv">$img</span><span class="p">))</span><span class="o">.</span><span class="nf">DrawImage</span><span class="p">([</span><span class="n">System.Drawing.Image</span><span class="p">]::</span><span class="nx">FromFile</span><span class="p">((</span><span class="n">Get-Item</span><span class="w"> </span><span class="nx">C:\img\20191104135629.jpg</span><span class="p">)),</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">128</span><span class="p">,</span><span class="w"> </span><span class="mi">128</span><span class="p">)</span><span class="w"> 
</span><span class="nv">$jpegCodecInfo</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="n">System.Drawing.Imaging.ImageCodecInfo</span><span class="p">]::</span><span class="n">GetImageEncoders</span><span class="p">()</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">where</span><span class="w"> </span><span class="p">{</span><span class="bp">$_</span><span class="o">.</span><span class="nf">MimeType</span><span class="w"> </span><span class="o">-eq</span><span class="w"> </span><span class="s1">'image/jpeg'</span><span class="p">}</span><span class="w"> </span><span class="nv">$encoderParams</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">New-Object</span><span class="w"> </span><span class="nx">System.Drawing.Imaging.EncoderParameters</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="w"> 
</span><span class="nv">$encoderParams</span><span class="o">.</span><span class="n">Param</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">New-Object</span><span class="w"> </span><span class="nx">System.Drawing.Imaging.EncoderParameter</span><span class="p">([</span><span class="n">System.Drawing.Imaging.Encoder</span><span class="p">]::</span><span class="n">Quality</span><span class="p">,</span><span class="w"> </span><span class="nx">90</span><span class="p">)</span><span class="w"> 
</span><span class="nv">$img</span><span class="o">.</span><span class="nf">Save</span><span class="p">(</span><span class="s2">"c:\img\bouska2.jpg"</span><span class="p">,</span><span class="w"> </span><span class="nv">$jpegCodecInfo</span><span class="p">,</span><span class="w"> </span><span class="nv">$encoderParams</span><span class="p">)</span><span class="w"> 
</span><span class="nv">$img</span><span class="o">.</span><span class="nf">Dispose</span><span class="p">()</span><span class="w"> 
</span></pre></table></code></div></div><h3 id="用git给github传文件"><span class="mr-2">用GIT给github传文件</span><a href="#用git给github传文件" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>github是个不要钱的图床，它支持用git来上传下载文件。</p><ul><li>配置本地git<div class="language-powershell highlighter-rouge"><div class="code-header"> <span data-label-text="Powershell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre><span class="n">git</span><span class="w"> </span><span class="nx">config</span><span class="w"> </span><span class="nt">--global</span><span class="w"> </span><span class="nx">user.name</span><span class="w"> </span><span class="s2">"用户名"</span><span class="w">
</span><span class="n">git</span><span class="w"> </span><span class="nx">config</span><span class="w"> </span><span class="nt">--global</span><span class="w"> </span><span class="nx">user.email</span><span class="w"> </span><span class="s2">"用户邮箱"</span><span class="w">
</span><span class="n">cd</span><span class="w"> </span><span class="nx">~/.ssh</span><span class="w">
</span><span class="n">ssh-keygen</span><span class="w"> </span><span class="nt">-t</span><span class="w"> </span><span class="nx">rsa</span><span class="w"> </span><span class="nt">-C</span><span class="w"> </span><span class="s2">"用户邮箱"</span><span class="w">
</span><span class="c">#上面这一步是生成一个证书，用来和github通信。</span><span class="w">
</span></pre></table></code></div></div><li>配置github接收密钥</ul><p>打开<a href="https://github.com/settings/profile">这里</a>，在右侧菜单栏中找到<code class="language-plaintext highlighter-rouge">SSH and GPG keys</code>，选择<code class="language-plaintext highlighter-rouge">new SSH key</code>，输入title，下面key的内容就是本机<code class="language-plaintext highlighter-rouge">ssh key</code>,也就是刚才生成的公钥，直接将id_rsa.pub中的内容粘贴过来就可以，然后点击下面的add SSH key即可完成。</p><ul><li>复制密钥</ul><p>输入这个命令<code class="language-plaintext highlighter-rouge">cat id_rsa.pub</code>，会出来类似下面的东西，复制出来，这就是密钥 <code class="language-plaintext highlighter-rouge">ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQDRyubAWD7PfF+baIYAYVpdtTag7YZYdmCNz2mkoMjxkP6aN5C/Rnxxxxxxxxxxxxxxxxxxxxx5sSNV42co5S4Tc5W3eBB9bPBIoObqZ/g8JkCVrEIgUXTO1rn9p7h5erQ0/TcC/tIQ+HVxVx+mV7Y/wcYY05+Bbm8Cv60= a9y@live.cn</code></p><ul><li>本地创建目录C:\gitupdate</ul><p><code class="language-plaintext highlighter-rouge">git remote add origin https://github.com/kukisama/kukisama.github.io</code>加个本地目录</p><p><code class="language-plaintext highlighter-rouge">git add c:/gitupdate/picupdate/tt.txt</code>上传本地文件</p><p><code class="language-plaintext highlighter-rouge">git commit -m "来个描述" </code></p><p><code class="language-plaintext highlighter-rouge">git push origin master</code>拉回来</p><p><code class="language-plaintext highlighter-rouge">git pull origin master</code>上传</p><p>前置条件准备的差不多了，可以看看完整代码。</p><h3 id="剪贴板直接保存png然后传到github上引用github-page的地址"><span class="mr-2">剪贴板直接保存png，然后传到github上，引用github page的地址</span><a href="#剪贴板直接保存png然后传到github上引用github-page的地址" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><div class="language-powershell highlighter-rouge"><div class="code-header"> <span data-label-text="Powershell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
</pre><td class="rouge-code"><pre><span class="c">#剪贴板直接保存png</span><span class="w">
</span><span class="n">Add-Type</span><span class="w"> </span><span class="nt">-Assembly</span><span class="w"> </span><span class="nx">PresentationCore</span><span class="w">
</span><span class="nv">$img</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="n">Windows.Clipboard</span><span class="p">]::</span><span class="n">GetImage</span><span class="p">()</span><span class="w">
</span><span class="kr">if</span><span class="w"> </span><span class="p">(</span><span class="bp">$null</span><span class="w"> </span><span class="o">-eq</span><span class="w"> </span><span class="nv">$img</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
  </span><span class="n">Write-Host</span><span class="w"> </span><span class="s2">"剪贴板无图"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span><span class="nv">$rootpath</span><span class="o">=</span><span class="s2">"C:/kukisama.github.io/picupdate/"</span><span class="w">
</span><span class="nv">$fcb</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">New-Object</span><span class="w"> </span><span class="nx">Windows.Media.Imaging.FormatConvertedBitmap</span><span class="p">(</span><span class="nv">$img</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="n">Windows.Media.PixelFormats</span><span class="p">]::</span><span class="n">Rgb24</span><span class="p">,</span><span class="w"> </span><span class="bp">$null</span><span class="p">,</span><span class="w"> </span><span class="nx">0</span><span class="p">)</span><span class="w">
</span><span class="nv">$filename</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">((</span><span class="n">Get-Date</span><span class="w"> </span><span class="nt">-f</span><span class="w"> </span><span class="nx">s</span><span class="p">)</span><span class="w"> </span><span class="o">-replace</span><span class="w"> </span><span class="s1">'[-T:]'</span><span class="p">,</span><span class="w"> </span><span class="s1">''</span><span class="p">)</span><span class="w">
</span><span class="nv">$file</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"</span><span class="nv">$rootpath</span><span class="s2">{0}.png"</span><span class="w"> </span><span class="nt">-f</span><span class="w"> </span><span class="nv">$filename</span><span class="w">
</span><span class="n">Write-Host</span><span class="w"> </span><span class="p">(</span><span class="s2">"</span><span class="se">`n</span><span class="s2"> 找到图片. {0}x{1} 像素，保存到{2}</span><span class="se">`n</span><span class="s2">"</span><span class="w"> </span><span class="nt">-f</span><span class="w"> </span><span class="nv">$img</span><span class="o">.</span><span class="nf">PixelWidth</span><span class="p">,</span><span class="w"> </span><span class="nv">$img</span><span class="o">.</span><span class="nf">PixelHeight</span><span class="p">,</span><span class="w"> </span><span class="nv">$file</span><span class="p">)</span><span class="w">
</span><span class="nv">$stream</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="n">IO.File</span><span class="p">]::</span><span class="n">Open</span><span class="p">(</span><span class="nv">$file</span><span class="p">,</span><span class="w"> </span><span class="s2">"OpenOrCreate"</span><span class="p">)</span><span class="w">
</span><span class="nv">$encoder</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">New-Object</span><span class="w"> </span><span class="nx">Windows.Media.Imaging.PngBitmapEncoder</span><span class="w">
</span><span class="nv">$encoder</span><span class="o">.</span><span class="nf">Frames</span><span class="o">.</span><span class="nf">Add</span><span class="p">([</span><span class="n">Windows.Media.Imaging.BitmapFrame</span><span class="p">]::</span><span class="nx">Create</span><span class="p">(</span><span class="nv">$fcb</span><span class="p">))</span><span class="w">
</span><span class="nv">$encoder</span><span class="o">.</span><span class="nf">Save</span><span class="p">(</span><span class="nv">$stream</span><span class="p">)</span><span class="w">
</span><span class="nv">$stream</span><span class="o">.</span><span class="nf">Dispose</span><span class="p">()</span><span class="w">
</span><span class="nv">$rootpath</span><span class="o">=</span><span class="s2">"C:/kukisama.github.io/picupdate/"</span><span class="w">
</span><span class="n">cd</span><span class="w"> </span><span class="nv">$rootpath</span><span class="w">
</span><span class="n">cd</span><span class="w"> </span><span class="o">..</span><span class="w">
</span><span class="nv">$lastfile</span><span class="o">=</span><span class="p">(</span><span class="n">ls</span><span class="w"> </span><span class="nv">$rootpath</span><span class="w"> </span><span class="o">|</span><span class="n">sort</span><span class="w"> </span><span class="nx">LastWriteTime</span><span class="w">  </span><span class="nt">-Descending</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="nf">name</span><span class="w">
</span><span class="nv">$MARKDOWNpic</span><span class="o">=</span><span class="n">New-Object</span><span class="w"> </span><span class="nx">System.Collections.ArrayList</span><span class="w">
</span><span class="nv">$MARKDOWNpic</span><span class="o">.</span><span class="nf">add</span><span class="p">(</span><span class="s1">'![image](http://github.ny9s.com/picupdate/'</span><span class="o">+</span><span class="nv">$lastfile</span><span class="o">+</span><span class="s1">')'</span><span class="p">)</span><span class="o">|</span><span class="n">out-null</span><span class="w">
</span><span class="nv">$MARKDOWNpic</span><span class="o">.</span><span class="nf">Add</span><span class="p">(</span><span class="s1">' '</span><span class="p">)</span><span class="o">|</span><span class="n">out-null</span><span class="w">
</span><span class="nv">$MARKDOWNpic</span><span class="o">|</span><span class="n">Set-Clipboard</span><span class="w">
</span><span class="nx">Write-Host</span><span class="w"> </span><span class="s2">"盆友，现在可以在MarkDown编辑器里面复制文本地址了"</span><span class="w">
</span><span class="n">git</span><span class="w"> </span><span class="nx">add</span><span class="w"> </span><span class="nv">$rootpath$lastfile</span><span class="w">
</span><span class="n">git</span><span class="w"> </span><span class="nx">commit</span><span class="w"> </span><span class="nt">-m</span><span class="w"> </span><span class="nv">$lastfile</span><span class="w">
</span><span class="n">git</span><span class="w"> </span><span class="nx">push</span><span class="w"> </span><span class="nt">-u</span><span class="w"> </span><span class="nx">origin</span><span class="w"> </span><span class="nx">master</span><span class="o">|</span><span class="n">Out-Null</span><span class="w"> </span><span class="nt">-ErrorAction</span><span class="w"> </span><span class="nx">SilentlyContinue</span><span class="w">
</span><span class="c">#git  rm -r C:/kukisama.github.io/picupdate/</span><span class="w">

</span></pre></table></code></div></div><h2 id="神转折"><span class="mr-2">神转折</span><a href="#神转折" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>功能逻辑基本算是完工了，但是突然我搜到这么一篇<a href="http://cn.voidcc.com/question/p-frcuitor-bka.html">神帖</a></p><p>看帖子的时间，2015年就已经有这逻辑了…………………… 这里有一个原生命令，<code class="language-plaintext highlighter-rouge">Set-Clipboard</code> 以及<code class="language-plaintext highlighter-rouge">Get-Clipboard</code> 所以保存文件只需要两步</p><div class="language-powershell highlighter-rouge"><div class="code-header"> <span data-label-text="Powershell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre><span class="nv">$PNGfile</span><span class="o">=</span><span class="n">Get-Clipboard</span><span class="w"> </span><span class="nt">-Format</span><span class="w"> </span><span class="nx">Image</span><span class="w">
</span><span class="nv">$PNGfile</span><span class="o">.</span><span class="nf">Save</span><span class="p">(</span><span class="nv">$file</span><span class="p">)</span><span class="w">
</span></pre></table></code></div></div><p>所以修改后的逻辑是这样的</p><div class="language-powershell highlighter-rouge"><div class="code-header"> <span data-label-text="Powershell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
</pre><td class="rouge-code"><pre><span class="nv">$PNGfile</span><span class="o">=</span><span class="n">Get-Clipboard</span><span class="w"> </span><span class="nt">-Format</span><span class="w"> </span><span class="nx">Image</span><span class="w">
</span><span class="kr">if</span><span class="w"> </span><span class="p">(</span><span class="nv">$PNGfile</span><span class="p">)</span><span class="w">
</span><span class="p">{</span><span class="w">
</span><span class="nv">$rootpath</span><span class="o">=</span><span class="s2">"C:/kukisama.github.io/picupdate/"</span><span class="w">
</span><span class="nv">$internetURL</span><span class="o">=</span><span class="s2">"http://github.ny9s.com/picupdate/"</span><span class="w">
</span><span class="nv">$filename</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">((</span><span class="n">Get-Date</span><span class="w"> </span><span class="nt">-f</span><span class="w"> </span><span class="nx">s</span><span class="p">)</span><span class="w"> </span><span class="o">-replace</span><span class="w"> </span><span class="s1">'[-T:]'</span><span class="p">,</span><span class="w"> </span><span class="s1">''</span><span class="p">)</span><span class="w">
</span><span class="nv">$file</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"</span><span class="nv">$rootpath</span><span class="s2">{0}.png"</span><span class="w"> </span><span class="nt">-f</span><span class="w"> </span><span class="nv">$filename</span><span class="w">
</span><span class="nv">$PNGfile</span><span class="o">.</span><span class="nf">Save</span><span class="p">(</span><span class="nv">$file</span><span class="p">)</span><span class="w">

</span><span class="n">cd</span><span class="w"> </span><span class="nv">$rootpath</span><span class="p">;</span><span class="n">cd</span><span class="w"> </span><span class="o">..</span><span class="w">
</span><span class="nv">$MARKDOWNpic</span><span class="o">=</span><span class="n">New-Object</span><span class="w"> </span><span class="nx">System.Collections.ArrayList</span><span class="w">

</span><span class="c">#$MARKDOWNpic.add('![image]('+$interneturl+$filename+'.png'+')')</span><span class="w">
</span><span class="c">#上面这个地址是github page的地址，但是实际来看，这个地址刷新的速度很慢，所以我直接取了文件的时间地址</span><span class="w">
</span><span class="nv">$MARKDOWNpic</span><span class="o">.</span><span class="nf">add</span><span class="p">(</span><span class="s1">'![image]('</span><span class="o">+</span><span class="s1">'https://github.com/kukisama/kukisama.github.io/blob/master/picupdate/'</span><span class="o">+</span><span class="nv">$filename</span><span class="o">+</span><span class="s1">'.png'</span><span class="o">+</span><span class="s1">'?raw=true)'</span><span class="p">)</span><span class="w">
</span><span class="nv">$MARKDOWNpic</span><span class="o">.</span><span class="nf">Add</span><span class="p">(</span><span class="s1">' '</span><span class="p">)</span><span class="w">
</span><span class="nv">$MARKDOWNpic</span><span class="o">|</span><span class="n">Set-Clipboard</span><span class="w">
</span><span class="nx">Write-Host</span><span class="w"> </span><span class="s2">"盆友，现在可以在MarkDown编辑器里面复制文本地址了"</span><span class="w">
</span><span class="n">git</span><span class="w"> </span><span class="nx">add</span><span class="w"> </span><span class="nv">$file</span><span class="w"> 
</span><span class="n">git</span><span class="w"> </span><span class="nx">commit</span><span class="w"> </span><span class="nt">-m</span><span class="w"> </span><span class="nv">$filename</span><span class="w"> 
</span><span class="n">git</span><span class="w"> </span><span class="nx">push</span><span class="w">  
</span><span class="p">}</span><span class="w">
</span></pre></table></code></div></div><h2 id="小技巧"><span class="mr-2">小技巧</span><a href="#小技巧" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>还收获了一个小技巧：针对对象输出的屏幕字符，可以先转换成字符串，然后输出到剪贴板</p><div class="language-powershell highlighter-rouge"><div class="code-header"> <span data-label-text="Powershell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="n">dir</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Out-String</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Set-Clipboard</span><span class="w"> 
</span></pre></table></code></div></div><h1 id="使用ftp上传">使用FTP上传</h1><p>github page的图床真的是不能明着说，反正国内就是不稳定。这里初步想法是使用最妥的FTP来完成图片的保存工作，自己架设一个FTP服务器，假设名字是 xxx.ny9s.com 实际对应web站点 ny9s.com/pic 实际要做的就是把图片传到FTP，然后生成对应的web端的字符串。 再次修改下脚本。</p><p>先照着<a href="https://blog.csdn.net/yancey_blog/article/details/52790451">Ubuntu16.04安装ftp服务器</a>去配置一下</p><div class="language-python highlighter-rouge"><div class="code-header"> <span data-label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
</pre><td class="rouge-code"><pre><span class="n">sudo</span> <span class="n">apt</span><span class="o">-</span><span class="n">get</span> <span class="n">install</span> <span class="n">vsftpd</span>
<span class="n">创建用户目录</span> <span class="n">sudo</span> <span class="n">mkdir</span> <span class="n">picupdate</span>
<span class="n">创建用户</span> <span class="n">sudo</span> <span class="n">useradd</span> <span class="o">-</span><span class="n">d</span> <span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">www</span><span class="o">/</span><span class="n">html</span><span class="o">/</span><span class="n">picupdate</span> <span class="o">-</span><span class="n">s</span> <span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="n">bash</span> <span class="n">uftp</span>
<span class="n">sudo</span> <span class="n">mkdir</span> <span class="n">picupdate</span>
<span class="n">sudo</span> <span class="n">vi</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">vsftpd</span><span class="p">.</span><span class="n">conf</span>
<span class="c1">#编辑vsftpd.conf文件
</span>
<span class="n">userlist_deny</span><span class="o">=</span><span class="n">NO</span>
<span class="n">userlist_enable</span><span class="o">=</span><span class="n">YES</span>
<span class="c1">#允许登录的用户
</span><span class="n">userlist_file</span><span class="o">=/</span><span class="n">etc</span><span class="o">/</span><span class="n">allowed_users</span>
<span class="n">seccomp_sandbox</span><span class="o">=</span><span class="n">NO</span>
<span class="c1">#默认ftp下载目录
</span><span class="n">local_root</span><span class="o">=/</span><span class="n">home</span><span class="o">/</span><span class="n">uftp</span><span class="o">/</span>
<span class="n">local_enable</span><span class="o">=</span><span class="n">YES</span>
<span class="c1">#设置文件上传
</span><span class="n">write_enable</span><span class="o">=</span><span class="n">YES</span>
<span class="c1">#使用utf8
</span><span class="n">utf8_filesystem</span><span class="o">=</span><span class="n">YES</span>
<span class="n">添加允许登录的用户</span>
<span class="n">sudo</span> <span class="n">gedit</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">allowed_users</span>

<span class="n">修改完之后保存</span><span class="err">，</span><span class="n">然后可以重启服务</span>
<span class="n">sudo</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">init</span><span class="p">.</span><span class="n">d</span><span class="o">/</span><span class="n">vsftpd</span> <span class="n">start</span>
<span class="n">sudo</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">init</span><span class="p">.</span><span class="n">d</span><span class="o">/</span><span class="n">vsftpd</span> <span class="n">stop</span>
<span class="n">sudo</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">init</span><span class="p">.</span><span class="n">d</span><span class="o">/</span><span class="n">vsftpd</span> <span class="n">restart</span>

 <span class="n">如果是开被动模式的花</span><span class="err">，</span>
<span class="n">打开xxx</span><span class="o">/</span><span class="n">vsftpd</span><span class="o">/</span><span class="n">vsftpd</span><span class="p">.</span><span class="n">conf</span><span class="err">，</span><span class="n">在末尾添加</span><span class="p">:</span>

<span class="n">pasv_enable</span><span class="o">=</span><span class="n">YES</span>   <span class="o">//</span><span class="n">开启PASV模式</span>
<span class="n">pasv_min_port</span><span class="o">=</span><span class="mi">40000</span>   <span class="o">//</span><span class="n">最小端口号</span>
<span class="n">pasv_max_port</span><span class="o">=</span><span class="mi">40000</span>   <span class="o">//</span><span class="n">最大端口号</span>
<span class="n">pasv_promiscuous</span><span class="o">=</span><span class="n">YES</span>

<span class="n">再配置下权限</span>
<span class="n">sudo</span> <span class="n">chown</span> <span class="n">uftp</span><span class="p">:</span><span class="n">uftp</span> <span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">www</span><span class="o">/</span><span class="n">html</span><span class="o">/</span><span class="n">picupdate</span><span class="o">/</span>

</pre></table></code></div></div><h2 id="ftp上传文件逻辑"><span class="mr-2">FTP上传文件逻辑</span><a href="#ftp上传文件逻辑" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><div class="language-powershell highlighter-rouge"><div class="code-header"> <span data-label-text="Powershell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
</pre><td class="rouge-code"><pre><span class="w">
</span><span class="c"># create the FtpWebRequest and configure it</span><span class="w">
</span><span class="nv">$ftp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="n">System.Net.FtpWebRequest</span><span class="p">]::</span><span class="n">Create</span><span class="p">(</span><span class="s2">"ftp://localhost/me.png"</span><span class="p">)</span><span class="w">
</span><span class="nv">$ftp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="n">System.Net.FtpWebRequest</span><span class="p">]</span><span class="nv">$ftp</span><span class="w">
</span><span class="nv">$ftp</span><span class="o">.</span><span class="nf">Method</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="n">System.Net.WebRequestMethods</span><span class="o">+</span><span class="n">Ftp</span><span class="p">]::</span><span class="n">UploadFile</span><span class="w">
</span><span class="nv">$ftp</span><span class="o">.</span><span class="nf">Credentials</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new-object</span><span class="w"> </span><span class="nx">System.Net.NetworkCredential</span><span class="p">(</span><span class="s2">"anonymous"</span><span class="p">,</span><span class="s2">"anonymous@localhost"</span><span class="p">)</span><span class="w">
</span><span class="nv">$ftp</span><span class="o">.</span><span class="nf">UseBinary</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="bp">$true</span><span class="w">
</span><span class="nv">$ftp</span><span class="o">.</span><span class="nf">UsePassive</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="bp">$true</span><span class="w">
</span><span class="c"># read in the file to upload as a byte array</span><span class="w">
</span><span class="nv">$content</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="n">System.IO.File</span><span class="p">]::</span><span class="n">ReadAllBytes</span><span class="p">(</span><span class="s2">"C:\me.png"</span><span class="p">)</span><span class="w">
</span><span class="nv">$ftp</span><span class="o">.</span><span class="nf">ContentLength</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">$content</span><span class="o">.</span><span class="nf">Length</span><span class="w">
</span><span class="c"># get the request stream, and write the bytes into it</span><span class="w">
</span><span class="nv">$rs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">$ftp</span><span class="o">.</span><span class="nf">GetRequestStream</span><span class="p">()</span><span class="w">
</span><span class="nv">$rs</span><span class="o">.</span><span class="nf">Write</span><span class="p">(</span><span class="nv">$content</span><span class="p">,</span><span class="w"> </span><span class="nx">0</span><span class="p">,</span><span class="w"> </span><span class="nv">$content</span><span class="o">.</span><span class="nf">Length</span><span class="p">)</span><span class="w">
</span><span class="c"># be sure to clean up after ourselves</span><span class="w">
</span><span class="nv">$rs</span><span class="o">.</span><span class="nf">Close</span><span class="p">()</span><span class="w">
</span><span class="nv">$rs</span><span class="o">.</span><span class="nf">Dispose</span><span class="p">()</span><span class="w">

</span></pre></table></code></div></div><div class="language-python highlighter-rouge"><div class="code-header"> <span data-label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
</pre><td class="rouge-code"><pre><span class="n">sudo</span> <span class="n">vi</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">vsftpd</span><span class="p">.</span><span class="n">conf</span>
<span class="n">sudo</span> <span class="n">vi</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">services</span>
<span class="n">sudo</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">init</span><span class="p">.</span><span class="n">d</span><span class="o">/</span><span class="n">vsftpd</span> <span class="n">restart</span>

<span class="n">vsftpd启动后</span><span class="err">，</span><span class="n">默认的ftp端口是21</span><span class="err">，</span><span class="n">现在我想把ftp端口改成</span> <span class="mi">801</span> <span class="p">,</span><span class="n">修改后能保证用户上传下载不受影响</span>
<span class="mf">1.</span><span class="n">编辑</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">vsftpd</span><span class="o">/</span><span class="n">vsftpd</span><span class="p">.</span><span class="n">conf</span> <span class="n">文件</span><span class="err">，</span><span class="n">在该配置文件中添加此行</span><span class="err">：</span><span class="n">listen_port</span><span class="o">=</span><span class="mi">801</span>
<span class="mf">2.</span><span class="n">编辑</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">services</span> <span class="n">文件</span><span class="err">，</span><span class="n">将其中的</span> 
<span class="n">ftp</span> <span class="mi">21</span><span class="o">/</span><span class="n">tcp</span> <span class="n">改为</span> <span class="n">ftp</span> <span class="mi">801</span><span class="o">/</span><span class="n">tcp</span> 
<span class="n">ftp</span> <span class="mi">21</span><span class="o">/</span><span class="n">udp改为</span> <span class="n">ftp</span> <span class="mi">801</span><span class="o">/</span><span class="n">udp</span>
<span class="mf">3.</span><span class="n">执行</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">init</span><span class="p">.</span><span class="n">d</span><span class="o">/</span><span class="n">vsftpd</span> <span class="n">restart</span> <span class="n">重新启动</span> <span class="n">vsftpd</span> <span class="n">服务</span><span class="err">。</span><span class="n">启动完成后可以使用</span> <span class="n">netstat</span> <span class="o">-</span><span class="n">ntpl</span> <span class="o">|</span> <span class="n">grep</span> <span class="n">vsftpd</span> <span class="n">命令可以查看到系统现</span>
<span class="n">监听的</span> <span class="n">vsftpd</span> <span class="n">的端口为</span> <span class="mi">801</span>
<span class="mf">4.</span><span class="n">使用</span> <span class="n">lftp</span> <span class="mf">192.168</span><span class="p">.</span><span class="mf">0.1</span><span class="p">:</span><span class="mi">801</span><span class="p">(</span><span class="mf">192.168</span><span class="p">.</span><span class="mf">0.1</span> <span class="n">是</span> <span class="n">vsftpd</span> <span class="n">服务器的地址</span> <span class="p">)</span><span class="err">，</span><span class="n">这样就可以访问到</span> <span class="n">ftp</span> <span class="n">服务器了</span><span class="err">。</span>

<span class="n">开启防火墙</span>
<span class="n">ufw</span> <span class="n">enable</span>
<span class="n">关闭防火墙</span>
<span class="n">ufw</span> <span class="n">disable</span>
</pre></table></code></div></div><p>然而上面的问题虽然看起来步骤应该很详细了，但是问题是在我的环境配置失败了……</p><h2 id="posh-ssh"><span class="mr-2">Posh SSH</span><a href="#posh-ssh" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>花了很多时间在FTP上，开始继续寻找解决方案。经过测试，最简单的方法是安装Posh-SSH模块，用SSH的方式去上传下载文件。这个模块在<a href="https://github.com/darkoperator/Posh-SSH/tree/master/Release">github</a>可以下载到。 <img data-src="../assets/20191107114255.png" alt="image" data-proofer-ignore></p><p>另外也可以使用<code class="language-plaintext highlighter-rouge">Install-Module -Name Posh-SSH -RequiredVersion 2.0.2</code>直接安装，我觉得优点如下：</p><ol><li>服务器只需要开SSH端口，而且这个端口可以不用22，映射成其他端口一样工作正常。<li>不用像FTP一样配主动被动模式，配账户，开端口改端口什么的<li>文件整体不大，才2M多，删除帮助文件之后才1.7M，不管是直接下载还是弄成离线包都可以实现。 4.大哥的代码封装的很出色了，上传下载文件只需要一条命令。自己写也差不多这样就是极限了。</ol><h2 id="代码范例"><span class="mr-2">代码范例</span><a href="#代码范例" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><div class="language-powershell highlighter-rouge"><div class="code-header"> <span data-label-text="Powershell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre><span class="nv">$cred</span><span class="o">=</span><span class="n">Get-Credential</span><span class="w"> 
</span><span class="c">#同意KEY，从远程下载文件</span><span class="w">
</span><span class="n">Get-SCPFile</span><span class="w"> </span><span class="nt">-ComputerName</span><span class="w"> </span><span class="s2">"ny9s.com"</span><span class="w"> </span><span class="nt">-Port</span><span class="w"> </span><span class="nx">12121</span><span class="w"> </span><span class="nt">-Credential</span><span class="w"> </span><span class="nv">$cred</span><span class="w">  </span><span class="nt">-RemoteFile</span><span class="w"> </span><span class="s2">"/home/kukisama/IOid.jpg"</span><span class="w"> </span><span class="nt">-LocalFile</span><span class="w"> </span><span class="s1">'C:\img\ppp.jpg'</span><span class="w"> </span><span class="nt">-AcceptKey</span><span class="w">
</span><span class="c">#上传</span><span class="w">
 </span><span class="n">Set-SCPFile</span><span class="w"> </span><span class="nt">-ComputerName</span><span class="w"> </span><span class="s2">"ny9s.com"</span><span class="w"> </span><span class="nt">-Port</span><span class="w"> </span><span class="nx">12121</span><span class="w"> </span><span class="nt">-Credential</span><span class="w"> </span><span class="nv">$cred</span><span class="w">  </span><span class="nt">-Remotepath</span><span class="w"> </span><span class="s2">"/home/kukisama"</span><span class="w"> </span><span class="nt">-LocalFile</span><span class="w"> </span><span class="s1">'C:\img\ppp.jpg'</span><span class="w">
</span></pre></table></code></div></div><h3 id="模块可清理的内容"><span class="mr-2">模块可清理的内容</span><a href="#模块可清理的内容" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p><img data-src="../assets/20191107112059.png" alt="image" data-proofer-ignore> 如果是在线安装的话，模块会位于 <code class="language-plaintext highlighter-rouge">C:\Program Files\WindowsPowerShell\Modules\Posh-SSH</code>如果不要了，直接删除就相当于卸载。 整体目录有2.26MB，有500K的帮助文件，测试后，发现删除没影响（en-US目录)。</p><h2 id="密码加解密逻辑"><span class="mr-2">密码加解密逻辑</span><a href="#密码加解密逻辑" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>为了静默连接SSH，所以用到一个密码逻辑，它可将所需要用到的$cred加密放在本地文件夹中，使用的时候会比较简单</p><div class="language-powershell highlighter-rouge"><div class="code-header"> <span data-label-text="Powershell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre><td class="rouge-code"><pre><span class="c">#步骤1、将密码加密后保持到c:\xxx.txt。</span><span class="w">
</span><span class="nv">$mysecret</span><span class="o">=</span><span class="s2">"xxxxxx"</span><span class="w"> </span><span class="c">#此处放密码</span><span class="w">
</span><span class="nv">$mysecret</span><span class="o">|</span><span class="n">ConvertTo-SecureString</span><span class="w"> </span><span class="nt">-AsPlainText</span><span class="w"> </span><span class="nt">-Force</span><span class="w"> </span><span class="o">|</span><span class="n">ConvertFrom-SecureString</span><span class="o">|</span><span class="n">Out-File</span><span class="w"> </span><span class="nx">C:\picupdate\pass.txt</span><span class="w"> </span><span class="nt">-Encoding</span><span class="w"> </span><span class="nx">utf8</span><span class="w">
</span><span class="c">#步骤2、将密文密码转换成powershell可以使用的格式</span><span class="w">
</span><span class="nv">$securestring</span><span class="o">=</span><span class="p">(</span><span class="n">Get-Content</span><span class="w"> </span><span class="nx">C:\picupdate\pass.txt</span><span class="p">)</span><span class="o">.</span><span class="nf">ToString</span><span class="p">()</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">ConvertTo-SecureString</span><span class="w">
</span><span class="nv">$ptr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="n">System.Runtime.InteropServices.Marshal</span><span class="p">]::</span><span class="n">SecureStringToGlobalAllocUnicode</span><span class="p">(</span><span class="nv">$secureString</span><span class="p">)</span><span class="w">
</span><span class="nv">$serverpass</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="n">System.Runtime.InteropServices.Marshal</span><span class="p">]::</span><span class="n">PtrToStringUni</span><span class="p">(</span><span class="nv">$ptr</span><span class="p">)</span><span class="w"> 
</span><span class="nv">$Password</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ConvertTo-SecureString</span><span class="w"> </span><span class="nv">$serverpass</span><span class="w"> </span><span class="nt">-AsPlainText</span><span class="w"> </span><span class="err">–</span><span class="nx">Force</span><span class="w">
</span><span class="c">#步骤3、使用</span><span class="w">
</span><span class="nv">$UserName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"admin"</span><span class="w">   </span><span class="c">#定义管理员账户名称</span><span class="w">
</span><span class="nv">$cred</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">New-Object</span><span class="w"> </span><span class="nx">System.Management.Automation.PSCredential</span><span class="p">(</span><span class="nv">$UserName</span><span class="p">,</span><span class="nv">$Password</span><span class="p">)</span><span class="w"> 
</span></pre></table></code></div></div><h1 id="整体代码png格式">整体代码，PNG格式</h1><div class="language-powershell highlighter-rouge"><div class="code-header"> <span data-label-text="Powershell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
</pre><td class="rouge-code"><pre><span class="nv">$PNGfile</span><span class="o">=</span><span class="n">Get-Clipboard</span><span class="w"> </span><span class="nt">-Format</span><span class="w"> </span><span class="nx">Image</span><span class="w">
</span><span class="kr">if</span><span class="w"> </span><span class="p">(</span><span class="nv">$PNGfile</span><span class="p">)</span><span class="w">
</span><span class="p">{</span><span class="w">
</span><span class="nv">$rootpath</span><span class="o">=</span><span class="s2">"C:/picupdate/"</span><span class="w">
</span><span class="nv">$internetURL</span><span class="o">=</span><span class="s2">"http://ny9s.com/picupdate/"</span><span class="w">
</span><span class="nv">$filename</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">((</span><span class="n">Get-Date</span><span class="w"> </span><span class="nt">-f</span><span class="w"> </span><span class="nx">s</span><span class="p">)</span><span class="w"> </span><span class="o">-replace</span><span class="w"> </span><span class="s1">'[-T:]'</span><span class="p">,</span><span class="w"> </span><span class="s1">''</span><span class="p">)</span><span class="w">
</span><span class="nv">$file</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"</span><span class="nv">$rootpath</span><span class="s2">{0}.png"</span><span class="w"> </span><span class="nt">-f</span><span class="w"> </span><span class="nv">$filename</span><span class="w">
</span><span class="nv">$PNGfile</span><span class="o">.</span><span class="nf">Save</span><span class="p">(</span><span class="nv">$file</span><span class="p">)</span><span class="w">
</span><span class="n">cd</span><span class="w"> </span><span class="nv">$rootpath</span><span class="w"> 
</span><span class="nv">$MARKDOWNpic</span><span class="o">=</span><span class="n">New-Object</span><span class="w"> </span><span class="nx">System.Collections.ArrayList</span><span class="w">
</span><span class="nv">$MARKDOWNpic</span><span class="o">.</span><span class="nf">add</span><span class="p">(</span><span class="s1">'![image]('</span><span class="o">+</span><span class="nv">$internetURL</span><span class="o">+</span><span class="nv">$filename</span><span class="o">+</span><span class="s1">'.png)'</span><span class="p">)</span><span class="w">
</span><span class="nv">$MARKDOWNpic</span><span class="o">.</span><span class="nf">Add</span><span class="p">(</span><span class="s1">' '</span><span class="p">)</span><span class="w">
</span><span class="nv">$MARKDOWNpic</span><span class="o">|</span><span class="n">Set-Clipboard</span><span class="w">
</span><span class="nx">Write-Host</span><span class="w"> </span><span class="s2">"盆友，现在可以在MarkDown编辑器里面复制文本地址了"</span><span class="w">

</span><span class="n">Import-Module</span><span class="w"> </span><span class="nx">D:\Posh-SSH\Posh-SSH.psd1</span><span class="w"> </span><span class="c">#注意模块，我这里是没有安装到系统中使用的</span><span class="w">
</span><span class="nv">$securestring</span><span class="o">=</span><span class="p">(</span><span class="n">Get-Content</span><span class="w"> </span><span class="nx">C:\picupdate\pass.txt</span><span class="p">)</span><span class="o">.</span><span class="nf">ToString</span><span class="p">()</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">ConvertTo-SecureString</span><span class="w">
</span><span class="nv">$ptr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="n">System.Runtime.InteropServices.Marshal</span><span class="p">]::</span><span class="n">SecureStringToGlobalAllocUnicode</span><span class="p">(</span><span class="nv">$secureString</span><span class="p">)</span><span class="w">
</span><span class="nv">$serverpass</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="n">System.Runtime.InteropServices.Marshal</span><span class="p">]::</span><span class="n">PtrToStringUni</span><span class="p">(</span><span class="nv">$ptr</span><span class="p">)</span><span class="w"> 
</span><span class="nv">$Password</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ConvertTo-SecureString</span><span class="w"> </span><span class="nv">$serverpass</span><span class="w"> </span><span class="nt">-AsPlainText</span><span class="w"> </span><span class="err">–</span><span class="nx">Force</span><span class="w">
</span><span class="nv">$UserName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"kukisama"</span><span class="w">   </span><span class="c">#定义管理员账户名称</span><span class="w">
</span><span class="nv">$cred</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">New-Object</span><span class="w"> </span><span class="nx">System.Management.Automation.PSCredential</span><span class="p">(</span><span class="nv">$UserName</span><span class="p">,</span><span class="nv">$Password</span><span class="p">)</span><span class="w"> 

</span><span class="c">#上传</span><span class="w">
</span><span class="n">Set-SCPFile</span><span class="w"> </span><span class="nt">-ComputerName</span><span class="w"> </span><span class="s2">"ny9s.com"</span><span class="w"> </span><span class="nt">-Port</span><span class="w"> </span><span class="nx">8888</span><span class="w"> </span><span class="nt">-Credential</span><span class="w"> </span><span class="nv">$cred</span><span class="w">  </span><span class="nt">-Remotepath</span><span class="w"> </span><span class="s2">"/var/www/html/picupdate"</span><span class="w"> </span><span class="nt">-LocalFile</span><span class="w"> </span><span class="err">$</span><span class="p">(</span><span class="nv">$rootpath</span><span class="o">+</span><span class="nv">$filename</span><span class="o">+</span><span class="s1">'.png'</span><span class="p">)</span><span class="w">
 </span><span class="p">}</span><span class="w">

</span></pre></table></code></div></div><h1 id="可优化项">可优化项</h1><p>考虑到图片上传怎么样都需要个几秒钟，所以逻辑上可以先生成MarkDown所需要的字符串，然后定期去上传，比如一分钟或者十分钟一次。这样体验上会好一些。</p><p>当然，上传完毕也要做一些标志位的检测，比如上传成功后，再也不会上传，记录上传时间，消耗时间什么的</p></div><div class="post-tail-wrapper text-muted"><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/powershell%E8%BF%9B%E9%98%B6%E5%AD%A6%E4%B9%A0/" class="post-tag no-text-decoration" >PowerShell进阶学习</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> 本文由作者按照 <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> 进行授权</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">分享</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=PowerShell%E4%BF%9D%E5%AD%98%E5%89%AA%E8%B4%B4%E6%9D%BF%E5%9B%BE%E7%89%87%E5%B9%B6%E6%9E%84%E9%80%A0MarkDown%E8%AF%AD%E5%8F%A5+-+%E4%B8%8D%E5%A4%AA%E7%9A%AE%E7%9A%84%E4%B9%9D%E5%8F%94&url=https%3A%2F%2Fkukisama.github.io%2FExportPictureFromClipboardToMarkDown%2F" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=PowerShell%E4%BF%9D%E5%AD%98%E5%89%AA%E8%B4%B4%E6%9D%BF%E5%9B%BE%E7%89%87%E5%B9%B6%E6%9E%84%E9%80%A0MarkDown%E8%AF%AD%E5%8F%A5+-+%E4%B8%8D%E5%A4%AA%E7%9A%AE%E7%9A%84%E4%B9%9D%E5%8F%94&u=https%3A%2F%2Fkukisama.github.io%2FExportPictureFromClipboardToMarkDown%2F" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://t.me/share/url?url=https%3A%2F%2Fkukisama.github.io%2FExportPictureFromClipboardToMarkDown%2F&text=PowerShell%E4%BF%9D%E5%AD%98%E5%89%AA%E8%B4%B4%E6%9D%BF%E5%9B%BE%E7%89%87%E5%B9%B6%E6%9E%84%E9%80%A0MarkDown%E8%AF%AD%E5%8F%A5+-+%E4%B8%8D%E5%A4%AA%E7%9A%AE%E7%9A%84%E4%B9%9D%E5%8F%94" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="分享链接" data-title-succeed="链接已复制！"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted"><div class="access"><div id="access-lastmod" class="post"><div class="panel-heading">最近更新</div><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/Cheapest_HCI/">AzureStack HCI的成本精算</a><li><a href="/JekyllfastStart/">Jekyll模板升级笔记</a><li><a href="/PowerShell_quickly_turns_multiple_lines_of_strings_into_objects/">PowerShell快速将多行字符串转成对象</a><li><a href="/SetDynamicMACScriptForHyper-VVrtualMachine/">为Hyper-V虚拟机设置动态MAC的脚本</a><li><a href="/PowerShell_and_i18n_thinking/">PowerShell与i18n的思考</a></ul></div><div id="access-tags"><div class="panel-heading">热门标签</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/powershell%E8%BF%9B%E9%98%B6%E5%AD%A6%E4%B9%A0/">PowerShell进阶学习</a> <a class="post-tag" href="/tags/powershell%E4%BC%98%E5%8C%96/">PowerShell优化</a> <a class="post-tag" href="/tags/powershell%E5%88%9D%E9%98%B6%E5%AD%A6%E4%B9%A0/">PowerShell初阶学习</a> <a class="post-tag" href="/tags/2022/">2022</a> <a class="post-tag" href="/tags/active/">Active</a> <a class="post-tag" href="/tags/azure/">Azure</a> <a class="post-tag" href="/tags/directory%E5%9F%9F%E8%BF%9B%E9%98%B6%E5%AD%A6%E4%B9%A0/">Directory域进阶学习</a> <a class="post-tag" href="/tags/hci/">HCI</a> <a class="post-tag" href="/tags/jekyll/">Jekyll</a> <a class="post-tag" href="/tags/sdn/">SDN</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"><div class="panel-heading pl-3 pt-2 mb-2">文章内容</div><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div id="tail-wrapper" class="col-12 col-lg-11 col-xl-9 pl-3 pr-3 pr-xl-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>相关文章</h3><div class="card-deck mb-4"><div class="card"> <a href="/PowerShell_and_i18n_thinking/"><div class="card-body"> <em class="small" data-ts="1626969600" data-df="YYYY-MM-DD" > 2021-07-23 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>PowerShell与i18n的思考</h3><div class="text-muted small"><p> 什么是i18n i18n（其来源是英文单词 internationalization的首末字符i和n，18为中间的字符数）是“国际化”的简称。在资讯领域，国际化(i18n)指让产品（出版物，软件，硬件等）无需做大的改变就能够适应不同的语言和地区的需要。对程序来说，在不修改内部代码的情况下，能根据不同语言及地区显示相应的界面。 在全球化的时代，国际化尤为重要，因为产品的潜在用户可能来自...</p></div></div></a></div><div class="card"> <a href="/Does_PowerShell_use_Switch_or_Bool_when_using_functions/"><div class="card-body"> <em class="small" data-ts="1629216000" data-df="YYYY-MM-DD" > 2021-08-18 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>PowerShell使用函数时采用Switch还是Bool？</h3><div class="text-muted small"><p> 这是一篇翻译整理的稿子，相对而言比较有用，分享出来给大家。 原帖为 Using PowerShell Switch vs. Boolean Parameters in SMA Runbooks 原文发表在2013年，但是2021年依然还是有这个问题，或者说是这种设计。 看完原文只有一个感觉：解决问题生硬粗暴，完全就是解决不了问题，直接解决掉提问题的人的样子。但是还就是...</p></div></div></a></div><div class="card"> <a href="/VSCode_backup_and_move_process/"><div class="card-body"> <em class="small" data-ts="1630598400" data-df="YYYY-MM-DD" > 2021-09-03 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>VSCode备份和搬家流程</h3><div class="text-muted small"><p> 背景 在系统重新安装或需要将自己的配置环境快速的复制到其他主机上时，可以采用此方法 多系统环境下，可以通过重定向插件目录，免除在每个系统中都下载一次插件的问题 在不联网的环境中，可以使用此方法将插件提前下载好，一次性解压至目标主机 安装 前往 https://code.visualstudio.com/ 根据操作系统下载安装即可 备份数据 总共需要备份两个内容，一个是插件，一个...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/TransitPowershellCodeUseMicrosoft/" class="btn btn-outline-primary" prompt="上一篇"><p>如何更智能的看懂PowerShell的英文注释</p></a> <a href="/FromVMMgetIPMIaddress/" class="btn btn-outline-primary" prompt="下一篇"><p>从VMM获取主机带外地址</p></a></div></div></div><footer class="row pl-3 pr-3"><div class="col-12 d-flex justify-content-between align-items-center text-muted pl-0 pr-0"><div class="footer-left"><p class="mb-0"> © 2022 <a href="https://twitter.com/jiuzige">不太皮的九叔</a>. <span data-toggle="tooltip" data-placement="top" title="除非另有说明，本网站上的博客文章均由作者按照知识共享署名 4.0 国际 (CC BY 4.0) 许可协议进行授权。">保留部分权利。</span></p></div><div class="footer-right"><p class="mb-0"> 本站由 <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> 生成，采用 <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> 主题。</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><div id="access-tags"><div class="panel-heading">热门标签</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/powershell%E8%BF%9B%E9%98%B6%E5%AD%A6%E4%B9%A0/">PowerShell进阶学习</a> <a class="post-tag" href="/tags/powershell%E4%BC%98%E5%8C%96/">PowerShell优化</a> <a class="post-tag" href="/tags/powershell%E5%88%9D%E9%98%B6%E5%AD%A6%E4%B9%A0/">PowerShell初阶学习</a> <a class="post-tag" href="/tags/2022/">2022</a> <a class="post-tag" href="/tags/active/">Active</a> <a class="post-tag" href="/tags/azure/">Azure</a> <a class="post-tag" href="/tags/directory%E5%9F%9F%E8%BF%9B%E9%98%B6%E5%AD%A6%E4%B9%A0/">Directory域进阶学习</a> <a class="post-tag" href="/tags/hci/">HCI</a> <a class="post-tag" href="/tags/jekyll/">Jekyll</a> <a class="post-tag" href="/tags/sdn/">SDN</a></div></div></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a><div id="notification" class="toast" role="alert" aria-live="assertive" aria-atomic="true" data-animation="true" data-autohide="false"><div class="toast-header"> <button type="button" class="ml-2 ml-auto close" data-dismiss="toast" aria-label="Close"> <span aria-hidden="true">&times;</span> </button></div><div class="toast-body text-center pt-0"><p class="pl-2 pr-2 mb-3">发现新版本的内容。</p><button type="button" class="btn btn-primary" aria-label="Update"> 更新 </button></div></div><script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">搜索结果为空</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/lozad/dist/lozad.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/dayjs@1/dayjs.min.js,npm/dayjs@1/locale/zh.min.js,npm/dayjs@1/plugin/relativeTime.min.js,npm/dayjs@1/plugin/localizedFormat.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/js/bootstrap.bundle.min.js"></script> <script defer src="/app.js"></script>
